---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

---
title: "SPASM"
author: "Dan Ovando"
date: "3/22/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# SPatial Age Structured Model

```{r}

library(tidyverse)
library(spasm)
library(stringr)
library(rfishbase)
library(modelr)

fish <- create_fish(adult_movement = 15,
                    density_dependence_form = 2)

fleet <-
  create_fleet(
    eq_f = .5,
    length_50_sel = 1,
    length_95_sel = 2,
    fish = fish,
    mpa_reaction = 'concentrate'
  )


without_mpa <-
  spasm::sim_fishery(
    fish = fish,
    fleet = fleet,
    manager  = create_manager(mpa_size = 0, year_mpa = 45),
    num_patches = 20,
    burn_year = 25,
    sim_years = 60
  ) %>%
  mutate(run = 'without_mpa')

with_mpa <-
  spasm::sim_fishery(
    fish = fish,
    fleet = fleet,
    manager  = create_manager(mpa_size = 0.2, year_mpa = 45),
    num_patches = 20,
    burn_year = 25,
    sim_years = 60
  ) %>%
  mutate(run = 'with_mpa')


without_mpa %>%
  group_by(year, mpa) %>%
  summarise(numbers = sum(numbers), ssb = sum(ssb)) %>%
  ggplot(aes(year, ssb, color = mpa)) +
  geom_line()


with_mpa %>%
  group_by(year, mpa) %>%
  summarise(numbers = sum(numbers), ssb = sum(ssb)) %>%
  ggplot(aes(year, ssb, color = mpa)) +
  geom_line() +
  facet_grid(mpa ~., scales = 'free_y')

with_mpa %>%
  group_by(year) %>%
  summarise(numbers = sum(numbers), ssb = sum(ssb)) %>%
  ggplot(aes(year, ssb)) +
  geom_line() +
  geom_vline(aes(xintercept = 45))

with_mpa %>% 
  group_by(year) %>% 
  summarise(catch = sum(biomass_caught)) %>% 
  ggplot(aes(year,catch)) + 
  geom_line()

with_mpa %>% 
  bind_rows(without_mpa) %>% 
  group_by(year, run) %>% 
  summarise(ssb = sum(ssb)) %>% 
  ggplot(aes(year,ssb, color = run)) + 
  geom_vline(aes(xintercept = 35), color = 'red') +
  geom_line()




```

